<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2015/9/9-2 | zszBlog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2015/9/9问题集Android 带清除功能的输入框控件ClearEditText,仿IOS的输入框 出处http://blog.csdn.net/xiaanming/article/details/11066685
就是在Android系统的输入框右边加入一个小图标，点击小图标可以清除输入框里面的内容，IOS上面直接设置某个属性就可以实现这一功能，但是Android原生EditText不具备">
<meta property="og:type" content="article">
<meta property="og:title" content="2015/9/9-2">
<meta property="og:url" content="http://yoursite.com/2015/09/09/2015-9-9-2/index.html">
<meta property="og:site_name" content="zszBlog">
<meta property="og:description" content="2015/9/9问题集Android 带清除功能的输入框控件ClearEditText,仿IOS的输入框 出处http://blog.csdn.net/xiaanming/article/details/11066685
就是在Android系统的输入框右边加入一个小图标，点击小图标可以清除输入框里面的内容，IOS上面直接设置某个属性就可以实现这一功能，但是Android原生EditText不具备">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2015/9/9-2">
<meta name="twitter:description" content="2015/9/9问题集Android 带清除功能的输入框控件ClearEditText,仿IOS的输入框 出处http://blog.csdn.net/xiaanming/article/details/11066685
就是在Android系统的输入框右边加入一个小图标，点击小图标可以清除输入框里面的内容，IOS上面直接设置某个属性就可以实现这一功能，但是Android原生EditText不具备">
  
  
  <link href='//fonts.useso.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo"></i><span class="site-title">zszBlog</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="http://cl.ly/image/382p262u1E3o/%60IF)_M7]QGJMAK096_$F$$6.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="q" value="site:http://yoursite.com"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/.">Home</a></td>
      
        <td><a class="main-nav-link" href="/archives">Archives</a></td>
      
        <td><a class="main-nav-link" href="/categories">Categories</a></td>
      
        <td><a class="main-nav-link" href="/tags">Tags</a></td>
      
        <td><a class="main-nav-link" href="/about">About</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="q" value="site:http://yoursite.com"></form>
      </td>
      </tr>
    </table>
  </div>
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="http://cl.ly/image/382p262u1E3o/%60IF)_M7]QGJMAK096_$F$$6.png">
      <h2 id="name">zszdevelop</h2>
      <h3 id="title">Java&amp;Android Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>XiaMen, China</span>
      <a id="follow" href="undefined">FOLLOW</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        77
        <span>posts</span>
      </div>
      <div class="article-info-block">
        0
        <span>tag</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="https://github.com/zszdevelop" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="/#" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="https://www.facebook.com/profile.php?id=100007317255366" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
        
        </tr>
      </table>
    </div>
    
  </div>
</aside>
      <section id="main"><article id="post-2015-9-9-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2015/9/9-2
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/09/09/2015-9-9-2/">
    <time datetime="2015-09-09T01:13:02.000Z" itemprop="datePublished">2015-09-09</time>
  </a>
</div>
          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2015/9/9问题集">2015/9/9问题集</h1><h2 id="Android_带清除功能的输入框控件ClearEditText,仿IOS的输入框">Android 带清除功能的输入框控件ClearEditText,仿IOS的输入框</h2><p> 出处<a href="http://blog.csdn.net/xiaanming/article/details/11066685" target="_blank" rel="external">http://blog.csdn.net/xiaanming/article/details/11066685</a></p>
<p>就是在Android系统的输入框右边加入一个小图标，点击小图标可以清除输入框里面的内容，IOS上面直接设置某个属性就可以实现这一功能，但是Android原生EditText不具备此功能，所以要想实现这一功能我们需要重写EditText，接下来就带大家来实现这一小小的功能<br>我们知道，我们可以为我们的输入框在上下左右设置图片，所以我们可以利用属性android:drawableRight设置我们的删除小图标</p>
<p>如果我们能为右边的图片设置监听，点击右边的图片清除输入框的内容并隐藏删除图标，这样子这个小功能就迎刃而解了，可是Android并没有给允许我们给右边小图标加监听的功能，这时候你是不是发现这条路走不通呢，其实不是，我们可能模拟点击事件，用输入框的的onTouchEvent()方法来模拟，<br>当我们触摸抬起（就是ACTION_UP的时候）的范围  大于输入框左侧到清除图标左侧的距离，小与输入框左侧到清除图片右侧的距离，我们则认为是点击清除图片，当然我这里没有考虑竖直方向，只要给清除小图标就上了监听，其他的就都好处理了</p>
<p>ClearEditText的代码</p>
<pre><code><span class="keyword">package</span> com.zsz.develop.clearedittextdemo;

<span class="keyword">import</span> android.content.Context;
<span class="keyword">import</span> android.graphics.drawable.Drawable;
<span class="keyword">import</span> android.text.Editable;
<span class="keyword">import</span> android.text.TextWatcher;
<span class="keyword">import</span> android.util.AttributeSet;
<span class="keyword">import</span> android.view.MotionEvent;
<span class="keyword">import</span> android.view.View;
<span class="keyword">import</span> android.view.View.OnFocusChangeListener;
<span class="keyword">import</span> android.view.animation.Animation;
<span class="keyword">import</span> android.view.animation.CycleInterpolator;
<span class="keyword">import</span> android.view.animation.TranslateAnimation;
<span class="keyword">import</span> android.widget.EditText;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClearEditText</span> <span class="keyword">extends</span> <span class="title">EditText</span> <span class="keyword">implements</span>  
    <span class="title">OnFocusChangeListener</span>, <span class="title">TextWatcher</span> </span>{ 

<span class="keyword">private</span> Drawable mClearDrawable; 

<span class="function"><span class="keyword">public</span> <span class="title">ClearEditText</span><span class="params">(Context context)</span> </span>{ 
    <span class="keyword">this</span>(context, <span class="keyword">null</span>); 
} 

<span class="function"><span class="keyword">public</span> <span class="title">ClearEditText</span><span class="params">(Context context, AttributeSet attrs)</span> </span>{
    <span class="comment">//这里构造方法也很重要，不加这个很多属性不能再XML里面定义  </span>
    <span class="keyword">this</span>(context, attrs, android.R.attr.editTextStyle);
} 

<span class="function"><span class="keyword">public</span> <span class="title">ClearEditText</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>{
    <span class="keyword">super</span>(context, attrs, defStyle);
    init();
}


<span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{ 
    mClearDrawable = getCompoundDrawables()[<span class="number">2</span>];
    <span class="keyword">if</span> (mClearDrawable == <span class="keyword">null</span>) { 
        mClearDrawable = getResources() 
                .getDrawable(R.drawable.emotionstore_progresscancelbtn);
    } 
    mClearDrawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, mClearDrawable.getIntrinsicWidth(), mClearDrawable.getIntrinsicHeight());
    <span class="comment">//默认设置隐藏图标</span>
    setClearIconVisible(<span class="keyword">false</span>);
    <span class="comment">//设置焦点改变的监听</span>
    setOnFocusChangeListener(<span class="keyword">this</span>);
    <span class="comment">//设置输入框里面内容发生改变的监听 </span>
    addTextChangedListener(<span class="keyword">this</span>); 
}
<span class="javadoc">/**
 * 因为我们不能直接给EditText设置点击事件，所以我们用记住我们按下的位置来模拟点击事件
 * 当我们按下的位置 在  EditText的宽度 - 图标到控件右边的间距 - 图标的宽度  和
 * EditText的宽度 - 图标到控件右边的间距之间我们就算点击了图标，竖直方向就没有考虑
 */</span>

<span class="annotation">@Override</span> 
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{ 
    <span class="keyword">if</span> (getCompoundDrawables()[<span class="number">2</span>] != <span class="keyword">null</span>) { 
        <span class="keyword">if</span> (event.getAction() == MotionEvent.ACTION_UP) { 
            <span class="keyword">boolean</span> touchable = event.getX() &gt; (getWidth() 
                    - getPaddingRight() - mClearDrawable.getIntrinsicWidth()) 
                    &amp;&amp; (event.getX() &lt; ((getWidth() - getPaddingRight())));
            <span class="keyword">if</span> (touchable) { 
                <span class="keyword">this</span>.setText(<span class="string">""</span>); 
            } 
        } 
    } 

    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onTouchEvent</span><span class="params">(event)</span></span>; 
}
<span class="javadoc">/**
 * 当ClearEditText焦点发生变化的时候，判断里面字符串长度设置清除图标的显示与隐藏
 */</span>

<span class="annotation">@Override</span> 
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onFocusChange</span><span class="params">(View v, <span class="keyword">boolean</span> hasFocus)</span> </span>{ 
    <span class="keyword">if</span> (hasFocus) { 
        setClearIconVisible(getText().length() &gt; <span class="number">0</span>); 
    } <span class="keyword">else</span> { 
        setClearIconVisible(<span class="keyword">false</span>); 
    } 
}

<span class="javadoc">/**
 * 设置清除图标的显示与隐藏，调用setCompoundDrawables为EditText绘制上去
 *<span class="javadoctag"> @param</span> visible
 */</span>

<span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">setClearIconVisible</span><span class="params">(<span class="keyword">boolean</span> visible)</span> </span>{ 
    Drawable right = visible ? mClearDrawable : <span class="keyword">null</span>; 
    setCompoundDrawables(getCompoundDrawables()[<span class="number">0</span>], 
            getCompoundDrawables()[<span class="number">1</span>], right, getCompoundDrawables()[<span class="number">3</span>]); 
}

<span class="javadoc">/**
 * 当输入框里面内容发生变化的时候回调的方法
 */</span>
<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, 
        <span class="keyword">int</span> after)</span> </span>{ 
    setClearIconVisible(s.length() &gt; <span class="number">0</span>); 
} 

<span class="annotation">@Override</span> 
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, 
        <span class="keyword">int</span> after)</span> </span>{ 

} 

<span class="annotation">@Override</span> 
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>{ 

}


<span class="javadoc">/**
 * 设置晃动动画
 */</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setShakeAnimation</span><span class="params">()</span></span>{
    <span class="keyword">this</span>.setAnimation(shakeAnimation(<span class="number">50</span>));
}

<span class="javadoc">/**
 * 晃动动画
 *<span class="javadoctag"> @param</span> counts 1秒钟晃动多少下
 *<span class="javadoctag"> @return</span>
 */</span>

<span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Animation <span class="title">shakeAnimation</span><span class="params">(<span class="keyword">int</span> counts)</span></span>{
    Animation translateAnimation = <span class="keyword">new</span> TranslateAnimation(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);
    translateAnimation.setInterpolator(<span class="keyword">new</span> CycleInterpolator(counts));
    translateAnimation.setDuration(<span class="number">1000</span>);
    <span class="keyword">return</span> translateAnimation;
}


}
</code></pre><p>xml的设置</p>
<pre><code>&lt;RelativeLayout xmlns:<span class="variable">android=</span><span class="string">"http://schemas.android.com/apk/res/android"</span>
xmlns:<span class="variable">tools=</span><span class="string">"http://schemas.android.com/tools"</span>
android:<span class="variable">layout_width=</span><span class="string">"match_parent"</span>
android:<span class="variable">layout_height=</span><span class="string">"match_parent"</span>
&gt;


&lt;com.zsz.develop.clearedittextdemo.ClearEditText
    android:<span class="variable">id=</span><span class="string">"@+id/filter_edit"</span>
    android:<span class="variable">layout_marginTop=</span><span class="string">"5dip"</span>
    android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>
    android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span>

    android:<span class="variable">drawableLeft=</span><span class="string">"@drawable/search_bar_icon_normal"</span>
    android:<span class="variable">hint=</span><span class="string">"dd"</span>
    android:<span class="variable">singleLine=</span><span class="string">"true"</span>
    android:<span class="variable">textSize=</span><span class="string">"15.0dip"</span> /&gt;
&lt;/RelativeLayout&gt;
</code></pre><h2 id="ListView的setSelection()和setSelectionFromTop()联系">ListView的setSelection()和setSelectionFromTop()联系</h2><p>通常，app中的数据都是以ListView的形式展示的。默认地，把“新”数据添加到数据列表的尾部。<br>但是，如果是IM类型的app，比如查看历史消息这个模块。新数据并不是插到数据列表的尾部，而是插到数据列表的头部。<br>要实现比较好的用户体验，需要保持当前的ListView的位置。换句话说，如果我们能够随心所欲地指定ListView滚动的位置，那么这个问题就迎刃而解。<br>在ListView中，有一个setSelectionFromTop()方法</p>
<p>他的源码如下：</p>
<pre><code><span class="comment">/** 
 * Sets the selected item and positions the selection y pixels from the top edge 
 * of the ListView. (If in touch mode, the item will not be selected but it will 
 * still be positioned appropriately.) 
 * 
 * @param position Index (starting at 0) of the data item to be selected. 
 * @param y The distance from the top edge of the ListView (plus padding) that the 
 *        item will be positioned. 
 */</span>  
public void setSelectionFromTop(int position, int y) {  
<span class="keyword">if</span> (<span class="variable">mAdapter =</span>= <span class="constant">null</span>) {  
    return;  
}  

<span class="keyword">if</span> (!isInTouchMode()) {  
    <span class="variable">position =</span> lookForSelectablePosition(position, <span class="constant">true</span>);  
    <span class="keyword">if</span> (position &gt;= <span class="number">0</span>) {  
        setNextSelectedPositionInt(position);  
    }  
} <span class="keyword">else</span> {  
    <span class="variable">mResurrectToPosition =</span> position;  
}  

<span class="keyword">if</span> (position &gt;= <span class="number">0</span>) {  
    <span class="variable">mLayoutMode =</span> LAYOUT_SPECIFIC;  
    <span class="variable">mSpecificTop =</span> mListPadding.top + y;  

    <span class="keyword">if</span> (mNeedSync) {  
        <span class="variable">mSyncPosition =</span> position;  
        <span class="variable">mSyncRowId =</span> mAdapter.getItemId(position);  
    }  

    requestLayout();  
}  
}  
</code></pre><p>从上面的代码可以得知，setSelectionFromTop()的作用是设置ListView选中的位置，同时在Y轴设置一个偏移量（padding值）。<br>ListView还有一个方法叫setSelection()，传入一个index整型数值，就可以让ListView定位到指定Item的位置。<br>这两个方法有什么区别呢？看一下setSelection()的具体实现，代码如下：</p>
<pre><code>/** 
 * Sets <span class="keyword">the</span> currently selected <span class="property">item</span>. If <span class="keyword">in</span> touch mode, <span class="keyword">the</span> <span class="property">item</span> will <span class="keyword">not</span> be selected 
 * <span class="keyword">but</span> <span class="keyword">it</span> will still be positioned appropriately. If <span class="keyword">the</span> specified selection position 
 * <span class="keyword">is</span> <span class="keyword">less than</span> <span class="number">0</span>, <span class="keyword">then</span> <span class="keyword">the</span> <span class="property">item</span> <span class="keyword">at</span> position <span class="number">0</span> will be selected. 
 * 
 * @param position Index (starting <span class="keyword">at</span> <span class="number">0</span>) <span class="keyword">of</span> <span class="keyword">the</span> data <span class="property">item</span> <span class="keyword">to</span> be selected. 
 */  
@Override  
public void setSelection(int position) {  
    setSelectionFromTop(position, <span class="number">0</span>);  
}  
</code></pre><p>原来，setSelection()内部就是调用了setSelectionFromTop()，只不过是Y轴的偏移量是0而已。<br>现在应该对setSelection()和setSelectionFromTop()有了更深刻的认识了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/09/09/2015-9-9-2/" data-id="cieo1ciqx0005uwb2gmfzy5ja" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/09/09/2015-9-9-3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          2015/9/9/3
        
      </div>
    </a>
  
  
    <a href="/2015/09/08/2015-9-9/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2015/9/9</div>
    </a>
  
</nav>

  
</article>

</section>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 zszdevelop<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    


<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>